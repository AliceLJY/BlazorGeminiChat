<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Gemini AI 聊天</title>
    <base href="/BlazorGeminiChat/" />
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" 
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    
    <!-- App CSS -->
    <link href="css/app.css" rel="stylesheet" />
    <link href="css/chat.css" rel="stylesheet" />
    <link href="BlazorGeminiChat.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>加载中...</p>
        </div>
    </div>

    <div id="error-container" style="display: none; background-color: #f8d7da; color: #721c24; padding: 20px; margin: 10px; border-radius: 5px; border: 1px solid #f5c6cb;">
        <h4>加载错误</h4>
        <p id="error-details"></p>
        <button onclick="location.reload()" class="btn btn-danger">重新加载</button>
    </div>

    <div id="blazor-error-ui">
        发生了未处理的错误。
        <a href="" class="reload">重新加载</a>
        <a class="dismiss">🗙</a>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bootstrap.bundle.min.js" 
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    
    <!-- Blazor WebAssembly JS -->
    <script>
        // 错误处理
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('JavaScript error:', message, source, lineno, colno, error);
            document.getElementById('error-details').textContent = message + (source ? (' at ' + source) : '');
            document.getElementById('error-container').style.display = 'block';
            return false;
        };
        
        // 自定义滚动函数
        window.scrollToBottom = function(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.scrollTop = element.scrollHeight;
            }
        };

        // 加载 Blazor WebAssembly
        function loadBlazor() {
            var script = document.createElement('script');
            script.src = '_framework/blazor.webassembly.js';
            script.onerror = function() {
                document.getElementById('error-details').textContent = 'Failed to load Blazor WebAssembly runtime. Check your network connection or try again later.';
                document.getElementById('error-container').style.display = 'block';
            };
            document.body.appendChild(script);
        }

        // 尝试加载
        window.addEventListener('DOMContentLoaded', loadBlazor);
    </script>
</body>

</html>